<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Neil's JSON → Excel Converter (Green Theme)</title>
  <style>
    :root{
      --green-900:#064e3b; /* headings */
      --green-800:#065f46;
      --green-700:#047857; /* accents */
      --green-600:#059669; /* primary */
      --green-500:#10b981; /* buttons */
      --green-400:#34d399; /* hover */
      --green-300:#6ee7b7; /* subtle */
      --green-100:#d1fae5; /* bg tint */
      --green-050:#ecfdf5; /* panel */
      --ink:#0b1720;
      --muted:#2a3a33;
      --border:#b7e5d2;
      --error:#b91c1c;
    }
    html,body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:var(--green-050); color:var(--ink)}
    header{position:sticky;top:0;z-index:3;background:linear-gradient(180deg,var(--green-600),var(--green-700));color:white;padding:14px 18px;box-shadow:0 4px 16px rgba(0,0,0,.12)}
    header h1{margin:0;font-size:1.2rem;letter-spacing:.3px}
    header p{margin:.25rem 0 0;opacity:.9;font-size:.9rem}.container{max-width:1100px;margin:18px auto;padding:0 14px;}
.grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
@media (max-width:980px){.grid{grid-template-columns:1fr}}

.card{background:white;border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 18px rgba(5,150,105,.10)}
.card h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--border);background:var(--green-050);color:var(--green-900);font-size:1rem}
.card .body{padding:14px}

.uploader{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.uploader input[type=file]{border:1px dashed var(--green-400);padding:10px;border-radius:10px;background:var(--green-050)}

.help{font-size:.9rem;color:var(--muted);}

.tree{max-height:360px;overflow:auto;border:1px solid var(--border);border-radius:12px;padding:10px;background:linear-gradient(180deg,white,var(--green-050))}
.tree-search{margin-bottom:8px}
.tree-search input{width:100%;padding:9px 10px;border-radius:10px;border:1px solid var(--border);}
.node{display:flex;align-items:center;gap:8px;padding:6px;border-radius:8px}
.node:hover{background:var(--green-100)}
.indent{width:12px;flex:0 0 12px}

.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{background:var(--green-600);color:white;padding:6px 10px;border-radius:999px;display:inline-flex;align-items:center;gap:8px;box-shadow:0 6px 10px rgba(16,185,129,.22)}
.chip .x{cursor:pointer;background:rgba(255,255,255,.2);padding:0 6px;border-radius:999px}

.btn{cursor:pointer;border:0;border-radius:10px;padding:10px 14px;background:var(--green-600);color:white;font-weight:600;box-shadow:0 6px 14px rgba(5,150,105,.25);transition:.15s}
.btn:hover{background:var(--green-500)}
.btn.secondary{background:white;color:var(--green-800);border:1px solid var(--green-400);box-shadow:none}
.btn.ghost{background:transparent;color:var(--green-700);border:1px dashed var(--green-400);box-shadow:none}
.btnbar{display:flex;flex-wrap:wrap;gap:10px}

table{width:100%;border-collapse:separate;border-spacing:0 6px}
thead th{position:sticky;top:0;background:var(--green-600);color:white;padding:10px;border:0}
tbody td{background:white;border:1px solid var(--border);padding:8px}

.error{color:white;background:var(--error);padding:8px 10px;border-radius:10px;margin:8px 0}

details{border:1px solid var(--border);border-radius:10px;padding:8px 10px;background:linear-gradient(180deg,white,var(--green-050));}
details>summary{cursor:pointer;font-weight:600;color:var(--green-800)}

.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media (max-width:700px){.stats{grid-template-columns:1fr}}
.stat{border:1px solid var(--border);border-radius:10px;padding:10px;background:white}
.kbd{font-family:ui-monospace,SFMono,Menlo,Consolas,monospace;background:var(--green-100);padding:2px 6px;border-radius:6px}
.small{font-size:.85rem;color:var(--muted)}

  </style>
</head>
<body>
  <header>
    <h1>Neil's JSON → Excel Converter</h1>
    <p>Upload JSON, pick nested fields, preview, download to Excel, and see stats — all in one green, friendly page.</p>
  </header>  <div class="container">
    <div class="grid">
      <section class="card">
        <h2>1) Upload & Inspect</h2>
        <div class="body">
          <div class="uploader">
            <input id="fileInput" type="file" accept="application/json,.json" />
            <button class="btn ghost" id="loadSample1">Load Sample: Flat</button>
            <button class="btn ghost" id="loadSample2">Load Sample: Nested</button>
            <button class="btn ghost" id="loadSample3">Load Sample: Deep</button>
          </div>
          <p class="help">Tip: Works with objects or arrays. We'll discover all leaf field paths (arrays shown as <span class="kbd">[*]</span>).</p>
          <div id="err" class="error" style="display:none"></div><details id="fieldsBox" style="margin-top:10px" open>
        <summary>Discovered Fields (click to add)</summary>
        <div class="tree-search">
          <input id="search" type="search" placeholder="Filter fields… (e.g. user.address[*].city)" />
        </div>
        <div id="tree" class="tree" aria-live="polite"></div>
      </details>

      <div style="margin-top:10px">
        <strong>Selected fields</strong>
        <div id="chips" class="chips" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>2) Actions</h2>
    <div class="body">
      <div class="btnbar" style="margin-bottom:12px">
        <button class="btn" id="previewBtn">Preview Table</button>
        <button class="btn secondary" id="statsBtn">Stats</button>
        <button class="btn" id="downloadXlsBtn">Download Excel (.xls)</button>
        <button class="btn secondary" id="downloadCsvBtn">Download CSV</button>
      </div>
      <p class="small">Excel download uses a standards-friendly HTML table with <code>.xls</code> extension that opens in Excel, Numbers, and Google Sheets. CSV is also available.</p>
    </div>
  </section>
</div>

<section class="card" style="margin-top:16px">
  <h2>3) Preview</h2>
  <div class="body">
    <div id="preview" style="overflow:auto; max-height:420px"></div>
  </div>
</section>

<section class="card" style="margin-top:16px">
  <h2>4) Stats</h2>
  <div class="body">
    <div id="stats" class="stats"></div>
  </div>
</section>

<section class="card" style="margin-top:16px">
  <h2>How to Run & Test Locally</h2>
  <div class="body">
    <ol>
      <li>Save this page as <span class="kbd">json-to-excel.html</span>.</li>
      <li>Double-click to open it in any modern browser (Chrome, Edge, Firefox, Safari).</li>
      <li>Click a sample button or upload your own <span class="kbd">.json</span> file.</li>
      <li>Pick fields, then use <em>Preview</em>, <em>Stats</em>, and <em>Download</em>.</li>
    </ol>
    <p class="small">No servers, libraries, or frameworks required. Everything runs in your browser.</p>
  </div>
</section>

  </div>  <script>
    // ------------------------------ Utilities ------------------------------
    const $ = sel => document.querySelector(sel);
    const errBox = $('#err');
    function showErr(msg){ errBox.style.display='block'; errBox.textContent = msg }
    function clearErr(){ errBox.style.display='none'; errBox.textContent = '' }

    function isObject(v){ return v && typeof v === 'object' && !Array.isArray(v) }

    // Walk JSON and collect leaf paths. Arrays indices are normalized to [*]
    function collectLeafPaths(node, path=[]) {
      const paths = [];
      const helper = (n, p) => {
        if (Array.isArray(n)){
          if (n.length===0){ paths.push([...p,'[*]'].join('.')); return }
          n.forEach((item)=> helper(item, [...p,'[*]']))
        } else if (isObject(n)){
          const keys = Object.keys(n);
          if (keys.length===0){ paths.push(p.join('.')) }
          for (const k of keys){ helper(n[k], [...p, k]) }
        } else {
          paths.push(p.join('.'))
        }
      }
      helper(node, path);
      // Unique & sorted by depth then alpha
      const uniq = [...new Set(paths.filter(Boolean))];
      return uniq.sort((a,b)=> (a.split('.').length - b.split('.').length) || a.localeCompare(b));
    }

    // Extract values by wildcard path like a.b[*].c[*].d
    function extractByPattern(root, pattern){
      const segs = pattern.split('.').filter(Boolean);
      const out = [];
      const dive = (node, idx) => {
        if (idx === segs.length){
          // reached leaf
          if (node === undefined) return;
          if (isObject(node) || Array.isArray(node)) out.push(JSON.stringify(node));
          else out.push(node);
          return;
        }
        const seg = segs[idx];
        if (seg === '[*]'){
          if (Array.isArray(node)){
            node.forEach(item => dive(item, idx+1));
          } else {
            // tolerate non-array by attempting to continue
            dive(node, idx+1);
          }
        } else {
          if (isObject(node)){
            dive(node[seg], idx+1);
          } else if (Array.isArray(node)){
            node.forEach(item => dive(item && item[seg], idx+1));
          } else {
            // primitive: cannot go deeper
          }
        }
      }
      dive(root, 0);
      return out;
    }

    function toCSV(rows){
      return rows.map(r=> r.map(v=>{
        const s = v===undefined||v===null? '' : String(v);
        if (/[",\n]/.test(s)) return '"'+s.replace(/"/g,'""')+'"';
        return s;
      }).join(',')).join('\n');
    }

    function download(filename, mime, content){
      const blob = new Blob([content], {type:mime});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=> URL.revokeObjectURL(a.href), 5000);
    }

    function buildHtmlTable(headers, rows){
      const th = headers.map(h=>`<th>${escapeHtml(h)}</th>`).join('');
      const tr = rows.map(r=> `<tr>${r.map(c=>`<td>${escapeHtml(c ?? '')}</td>`).join('')}</tr>`).join('');
      return `<!DOCTYPE html><html><head><meta charset="utf-8"></head><body><table border="1"><thead><tr>${th}</tr></thead><tbody>${tr}</tbody></table></body></html>`;
    }

    function escapeHtml(s){
      s = (s===undefined||s===null)? '' : String(s);
      return s.replace(/[&<>\"]/g, ch=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[ch]));
    }

    // ------------------------------ State ------------------------------
    let RAW = null;            // The loaded JSON object/array
    let FIELD_PATHS = [];      // All discovered leaf paths with [*] normalization
    const SELECTED = new Set();// User-selected paths

    // ------------------------------ Rendering ------------------------------
    function renderTree(){
      const q = $('#search').value.trim().toLowerCase();
      const box = $('#tree');
      box.innerHTML = '';
      FIELD_PATHS.forEach(path=>{
        if (q && !path.toLowerCase().includes(q)) return;
        const depth = path.split('.').length;
        const div = document.createElement('div');
        div.className = 'node';
        // Indent visually
        for (let i=1;i<depth;i++){ const ind=document.createElement('span'); ind.className='indent'; div.appendChild(ind) }
        const btn = document.createElement('button');
        btn.className = 'btn secondary';
        btn.textContent = SELECTED.has(path) ? 'Added' : 'Add';
        btn.disabled = SELECTED.has(path);
        btn.style.padding='4px 8px'; btn.style.fontSize='.85rem';
        btn.addEventListener('click',()=>{ SELECTED.add(path); renderChips(); renderTree(); });
        const label = document.createElement('span');
        label.textContent = path;
        label.style.fontFamily='ui-monospace, SFMono, Menlo, Consolas, monospace';
        div.appendChild(btn); div.appendChild(label);
        box.appendChild(div);
      })
      if (!box.children.length){
        box.innerHTML = '<div class="small">No fields match this filter.</div>'
      }
    }

    function renderChips(){
      const c = $('#chips'); c.innerHTML='';
      if (SELECTED.size===0) c.innerHTML = '<span class="small">No fields selected yet.</span>';
      for (const p of SELECTED){
        const chip = document.createElement('span'); chip.className='chip';
        chip.innerHTML = `<span>${p}</span>`;
        const x = document.createElement('span'); x.className='x'; x.textContent='✕'; x.title='Remove';
        x.addEventListener('click',()=>{ SELECTED.delete(p); renderChips(); renderTree(); });
        chip.appendChild(x); c.appendChild(chip);
      }
    }

    function buildTableData(){
      if (!RAW) throw new Error('No JSON loaded yet.');
      if (SELECTED.size===0) throw new Error('Select at least one field.');
      const headers = [...SELECTED];
      const columns = headers.map(h=> extractByPattern(RAW, h));
      const maxRows = Math.max(0, ...columns.map(c=> c.length));
      const rows = Array.from({length:maxRows}, (_,i)=> columns.map(col=> col[i] ?? ''));
      return { headers, rows, columns };
    }

    function renderPreview(){
      try{
        clearErr();
        const {headers, rows} = buildTableData();
        const table = document.createElement('table');
        const thead = document.createElement('thead'); const trh=document.createElement('tr');
        headers.forEach(h=>{ const th=document.createElement('th'); th.textContent=h; trh.appendChild(th); });
        thead.appendChild(trh); table.appendChild(thead);
        const tbody = document.createElement('tbody');
        rows.forEach(r=>{ const tr=document.createElement('tr'); r.forEach(c=>{ const td=document.createElement('td'); td.textContent=(c===undefined||c===null)? '' : c; tr.appendChild(td)}); tbody.appendChild(tr) });
        table.appendChild(tbody);
        const pv = $('#preview'); pv.innerHTML=''; pv.appendChild(table);
      } catch(e){ showErr(e.message) }
    }

    function renderStats(){
      try{
        clearErr();
        const {headers, rows, columns} = buildTableData();
        const statsBox = $('#stats'); statsBox.innerHTML='';
        const total = rows.length;
        headers.forEach((h, idx)=>{
          const col = columns[idx];
          const nonEmpty = col.filter(v=> v!==undefined && v!==null && String(v)!=='').length;
          const missing = total - nonEmpty;
          const uniques = new Set(col.map(v=> v===undefined||v===null? '' : String(v))).size;
          const numVals = col.map(v=> Number(v)).filter(v=> !Number.isNaN(v));
          const numeric = numVals.length>0;
          const mean = numeric? (numVals.reduce((a,b)=>a+b,0)/numVals.length).toFixed(4) : '—';
          const min = numeric? Math.min(...numVals) : '—';
          const max = numeric? Math.max(...numVals) : '—';
          const card = document.createElement('div'); card.className='stat';
          card.innerHTML = `<div style="font-weight:700;color:var(--green-800);margin-bottom:6px">${h}</div>
            <div class="small">Rows: <strong>${total}</strong></div>
            <div class="small">Values: <strong>${nonEmpty}</strong> • Missing: <strong>${missing}</strong></div>
            <div class="small">Unique: <strong>${uniques}</strong></div>
            <div class="small">Numeric: <strong>${numeric? 'yes':'no'}</strong></div>
            <div class="small">Min: <strong>${min}</strong> • Max: <strong>${max}</strong> • Mean: <strong>${mean}</strong></div>`;
          statsBox.appendChild(card);
        })
      } catch(e){ showErr(e.message) }
    }

    // ------------------------------ Event wiring ------------------------------
    $('#search').addEventListener('input', renderTree);

    $('#previewBtn').addEventListener('click', renderPreview);
    $('#statsBtn').addEventListener('click', renderStats);

    $('#downloadCsvBtn').addEventListener('click', ()=>{
      try{
        clearErr();
        const {headers, rows} = buildTableData();
        const csv = toCSV([headers, ...rows]);
        download('extracted.csv', 'text/csv;charset=utf-8', csv);
      } catch(e){ showErr(e.message) }
    })

    $('#downloadXlsBtn').addEventListener('click', ()=>{
      try{
        clearErr();
        const {headers, rows} = buildTableData();
        const html = buildHtmlTable(headers, rows);
        download('extracted.xls', 'application/vnd.ms-excel', html);
      } catch(e){ showErr(e.message) }
    })

    $('#fileInput').addEventListener('change', async (e)=>{
      const f = e.target.files?.[0];
      if (!f) return;
      try{
        clearErr();
        const text = await f.text();
        const json = JSON.parse(text);
        RAW = json;
        FIELD_PATHS = collectLeafPaths(RAW);
        SELECTED.clear();
        renderTree(); renderChips();
        $('#preview').innerHTML=''; $('#stats').innerHTML='';
      } catch(err){ showErr('Failed to parse JSON: '+ err.message) }
    })

    // ------------------------------ Samples ------------------------------
    const SAMPLE_FLAT = [
      { id:1, name:'Ada', age:36, city:'Pune' },
      { id:2, name:'Ben', age:28, city:'Hyderabad' },
      { id:3, name:'Chai', age:null, city:'' }
    ];

    const SAMPLE_NESTED = {
      team:'Delta',
      users:[
        { id:1, profile:{ first:'Neil', last:'T', address:{ city:'Mumbai', zip:'400001' }}, tags:['admin','founder'] },
        { id:2, profile:{ first:'Ana', last:'B', address:{ city:'Pune', zip:'411001' }}, tags:['editor'] }
      ],
      created:'2025-09-01'
    };

    const SAMPLE_DEEP = {
      org:{ name:'Acme', regions:[{ name:'West', offices:[{code:'HYD', staff:[{name:'Sam', pay:42000},{name:'Ira', pay:51000}]}, {code:'PUN', staff:[]}] }, { name:'South', offices:[{code:'BLR', staff:[{name:'Lee', pay:61000}]}]}] },
      orders:[{ id:'A1', items:[{ sku:'X1', qty:2, price:199.9}, {sku:'X2', qty:1, price:99.5}] }, { id:'A2', items:[{ sku:'Y1', qty:3, price:49.9}]}]
    };

    function loadSample(data){
      RAW = data;
      FIELD_PATHS = collectLeafPaths(RAW);
      SELECTED.clear();
      renderTree(); renderChips();
      $('#preview').innerHTML=''; $('#stats').innerHTML=''; clearErr();
      // Preselect a few common fields
      const suggest = FIELD_PATHS.slice(0, Math.min(3, FIELD_PATHS.length));
      suggest.forEach(s=> SELECTED.add(s));
      renderChips(); renderTree();
    }

    $('#loadSample1').addEventListener('click', ()=> loadSample(SAMPLE_FLAT));
    $('#loadSample2').addEventListener('click', ()=> loadSample(SAMPLE_NESTED));
    $('#loadSample3').addEventListener('click', ()=> loadSample(SAMPLE_DEEP));

    // Initial UI state
    renderChips();
  </script></body>
</html>
